# compose/vite/Dockerfile

# -----------------------------------------------------------
# devã‚¹ãƒ†ãƒ¼ã‚¸: é–‹ç™ºç’°å¢ƒç”¨ã®ãƒ“ãƒ«ãƒ‰
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®ã¿ã‚’è¡Œã„ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ”ãƒ¼ã—ãªã„
# -----------------------------------------------------------
FROM node:22-alpine AS dev

WORKDIR /app

# package.jsonã¨.yarnrc.ymlã‚’ã‚³ãƒ”ãƒ¼
# ã“ã‚Œã«ã‚ˆã‚Šã€é–‹ç™ºç’°å¢ƒã§ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã—ã¦ã‚‚ã€
# node_modulesãŒä¸Šæ›¸ãã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹
COPY package.json .yarnrc.yml ./

# corepackã‚’æœ‰åŠ¹ã«ã—ã€yarnã®å®‰å®šç‰ˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN corepack enable && yarn set version stable

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN yarn install

# -----------------------------------------------------------
# prodã‚¹ãƒ†ãƒ¼ã‚¸: æœ¬ç•ªç’°å¢ƒç”¨ã®ãƒ“ãƒ«ãƒ‰
# devã‚¹ãƒ†ãƒ¼ã‚¸ã‹ã‚‰ä¾å­˜é–¢ä¿‚ã‚’ã‚³ãƒ”ãƒ¼ã—ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãƒ“ãƒ«ãƒ‰ã™ã‚‹
# -----------------------------------------------------------
FROM node:22-alpine AS prod

WORKDIR /app

# package.jsonã¨.yarnrc.ymlã‚’ã‚³ãƒ”ãƒ¼
COPY package.json .yarnrc.yml ./

# prodã‚¹ãƒ†ãƒ¼ã‚¸ã§ã‚‚corepackã‚’æœ‰åŠ¹åŒ–
RUN corepack enable && yarn set version stable

COPY . .

# æœ¬ç•ªç’°å¢ƒã§ã‚‚ä¾å­˜é–¢ä¿‚ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
# devDependenciesã‚‚å«ã‚ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã«ã€productionãƒ•ãƒ©ã‚°ã‚’ä»˜ã‘ãªã„
RUN yarn install

# ğŸ‘ˆ [è¿½åŠ ] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰
RUN yarn build