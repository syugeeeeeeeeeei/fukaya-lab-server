# ProjectBotany/docker-compose.yml (ä¿®æ­£)
services:
  # -----------------------------------------------------------
  #  ğŸŒ¿ ProjectBotany (æœ¬ç•ªç’°å¢ƒ: prod)
  #  (docker-compose --profile prod up -d ã§èµ·å‹•)
  # -----------------------------------------------------------
  projectbotany-vite:
    build:
      context: ./vite
      dockerfile: Dockerfile
      target: prod # ğŸ‘ˆ [å¤‰æ›´] prod ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã«ã™ã‚‹
    container_name: projectbotany-vite # ğŸ‘ˆ [è¿½åŠ ] ã‚³ãƒ³ãƒ†ãƒŠåã‚’æŒ‡å®š
    volumes:
      - ./vite:/app:delegated
      - /app/node_modules
    networks:
      - fukaya-lab-network # ğŸ‘ˆ [å¤‰æ›´] å…±é€šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å¤‰æ›´
    restart: unless-stopped
    command: ["yarn", "dev"]
    labels:
      # ğŸ‘ˆ [è¿½åŠ ] Caddy ã®è¨­å®š
      caddy: projectbotany.app.fukaya-sus.lab # ãƒ‰ãƒ¡ã‚¤ãƒ³å
      caddy.reverse_proxy: "{{upstreams 5173}}" # package.json ã® "start" ãƒãƒ¼ãƒˆ
      caddy.tls: "internal"
    profiles: ["prod"] # ğŸ‘ˆ [è¿½åŠ ] prod ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ã¿èµ·å‹•

  # -----------------------------------------------------------
  #  ğŸ› ï¸ ProjectBotany (é–‹ç™ºç’°å¢ƒ: dev)
  #  (docker-compose --profile dev up -d ã§èµ·å‹•)
  # -----------------------------------------------------------
  projectbotany-vite-dev:
    build:
      context: ./vite
      dockerfile: Dockerfile
      target: dev # ğŸ‘ˆ [è¿½åŠ ] dev ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã«ã™ã‚‹
    container_name: projectbotany-vite-dev # ğŸ‘ˆ [è¿½åŠ ] é–‹ç™ºç”¨ã‚³ãƒ³ãƒ†ãƒŠå
    volumes:
      - ./vite:/app:delegated
      - /app/node_modules
    networks:
      - fukaya-lab-network # ğŸ‘ˆ [è¿½åŠ ] å…±é€šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å‚åŠ 
    restart: unless-stopped
    command: ["yarn", "dev"] # ğŸ‘ˆ [è¿½åŠ ] é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
    labels:
      # ğŸ‘ˆ [è¿½åŠ ] Caddy ã®è¨­å®š (é–‹ç™ºç”¨)
      caddy: projectbotany.app.fukaya-sus.lab # é–‹ç™ºç”¨ãƒ‰ãƒ¡ã‚¤ãƒ³
      caddy.reverse_proxy: "{{upstreams 5173}}" # Vite é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒˆ
      caddy.tls: "internal"
    profiles: ["dev"] # ğŸ‘ˆ [è¿½åŠ ] dev ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ã¿èµ·å‹•

networks:
  # ğŸ‘ˆ [å¤‰æ›´] å…±é€šã®å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´
  fukaya-lab-network:
    external: true
    name: fukaya-lab-network