# /fukaya-lab-server/OruCa/justfile (æ–°è¦ä½œæˆ)

# --- ğŸ› ï¸ OruCa ãƒ“ãƒ«ãƒ‰ã‚¿ã‚¹ã‚¯ ---
# ãƒ«ãƒ¼ãƒˆã® 'build' ãƒ¡ã‚¿ã‚¿ã‚¹ã‚¯ã‹ã‚‰ 'OruCa::build' ã¨ã—ã¦å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚
build:
    @echo "ğŸ› ï¸ Building OruCa frontend application..."
    # 'vite' ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã£ã¦ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
    @docker compose --profile dev run --rm vite yarn build
    @echo "âœ… OruCa Frontend built to ./vite/dist/"


# --- ğŸ“¦ OruCa å›ºæœ‰ã‚¿ã‚¹ã‚¯ ---
# 'just OruCa::usb' ã®ã‚ˆã†ã«å‘¼ã³å‡ºã—ã¾ã™ã€‚

# (WSLç”¨) OruCaã®NFCãƒªãƒ¼ãƒ€ãƒ¼ã‚’WSLã«ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™
# (OruCa/Makefile ã® 'attach-usb' ã‹ã‚‰ç§»æ¤)
usb:
    @echo "ğŸ”Œ Attaching USB FeliCa Reader to WSL..."
    @powershell.exe -ExecutionPolicy Bypass -File ./usb-wsl-attach.ps1
    @echo "âœ… USB device attached."

# OruCaã®DBãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä¿å­˜ã—ã¾ã™
# (OruCa/Makefile ã® 'save-backup' ã‹ã‚‰ç§»æ¤)
backup:
    @echo "ğŸ’¾ Saving OruCa MySQL backup..."
    @# ãƒ«ãƒ¼ãƒˆã® 'set export' ã«ã‚ˆã‚Š $MYSQL_USER ç­‰ãŒç’°å¢ƒå¤‰æ•°ã¨ã—ã¦åˆ©ç”¨å¯èƒ½ã§ã™
    @docker compose exec oruca-mysql sh -c \
        "mysqldump -u${MYSQL_USER} -p${MYSQL_PASSWORD} ${MYSQL_DATABASE} > /backups/backup-$$(date +%Y%m%d-%H%M%S).sql"
    @echo "âœ… Backup created in OruCa mysql volume's /backups directory."

# OruCaã®DBãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒªã‚¹ãƒˆã‚¢ã—ã¾ã™ (ä¾‹: just OruCa::restore backup-YYYYMMDD.sql)
# (OruCa/Makefile ã® 'restore-backup' ã‹ã‚‰ç§»æ¤)
restore BACKUP_FILE:
    @echo "ğŸ”„ Restoring OruCa MySQL backup from {{BACKUP_FILE}}..."
    @docker compose exec -T oruca-mysql sh -c \
        "mysql -u${MYSQL_USER} -p${MYSQL_PASSWORD} ${MYSQL_DATABASE} < /backups/{{BACKUP_FILE}}"
    @echo "âœ… Restore complete."