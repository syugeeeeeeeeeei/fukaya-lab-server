services:
  gitlab:
    image: 'gitlab/gitlab-ce:latest' # 使用するGitLabのDockerイメージ（Community Editionの最新版）
    container_name: gitlab_server # コンテナに付ける名前
    restart: always # コンテナが予期せず停止した場合に常に再起動する
    hostname: 'gitlab.fukaya-sus.lab' # GitLabインスタンスのホスト名。実際にアクセスするドメイン名またはIPアドレスに変更してください。

    environment:
      GITLAB_OMNIBUS_CONFIG: |
        # ここに 'gitlab.rb' に記述するような設定を追加できます。
        # 例えば、外部URLの設定 (HTTPSを有効にする場合は 'https' に変更し、証明書の設定も必要です):
        # external_url 'http://gitlab.example.com'
        #
        # SSHポートを変更する場合 (例: 2222番ポートを使用):
        gitlab_rails['gitlab_shell_ssh_port'] = 2222
        #
        # 必要な設定をここに追加してください。
        # 詳細はGitLabの公式ドキュメントを参照してください:
        # https://docs.gitlab.com/omnibus/settings/configuration.html
        #
        # 例: Let's Encrypt を使用したHTTPS設定 (ドメインとメールアドレスを適切に設定してください)
        # external_url 'https://gitlab.example.com'
        # letsencrypt['enable'] = true
        # letsencrypt['contact_emails'] = ['your-email@example.com'] # あなたのメールアドレスに変更
        # nginx['redirect_http_to_https'] = true
        gitlab_rails['gitlab_default_locale'] = 'ja'
    ports:
      - '2222:22'    # SSH - ホストOSの22番ポートが既に使用中の場合は、'2222:22' のように変更し、
                   # 上記 GITLAB_OMNIBUS_CONFIG 内で gitlab_rails['gitlab_shell_ssh_port'] も合わせて変更してください。
    expose:
      - '80'    # Web UI (HTTP)
      # - '443:443'  # Web UI (HTTPS) - external_urlでHTTPSを設定し、証明書が用意されている場合に有効

    volumes:
      # ホストOSのパス : コンテナ内のパス
      - 'gitlab_config:/etc/gitlab'    # GitLabの設定ファイルを永続化
      - 'gitlab_logs:/var/log/gitlab'  # GitLabのログファイルを永続化
      - 'gitlab_data:/var/opt/gitlab'  # GitLabのデータ（リポジトリ、アップロードファイル等）を永続化

    shm_size: '256m' # Puma（GitLabのWebサーバー）のために推奨される共有メモリサイズ
    networks:
      - fukaya-lab-network