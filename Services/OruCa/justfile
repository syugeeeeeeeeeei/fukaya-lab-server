# /OruCa/justfile (ä¿®æ­£å¾Œ)
_default:
  @just --list -u

[doc("OruCa ã‚µãƒ¼ãƒ“ã‚¹ã«å¿…è¦ãª Podman ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚")]
build:
    @echo "==> ğŸ”¨ Building OruCa images..."
    @docker compose --env-file ../../.env build
    @echo "==> âœ… OruCa images built."

[doc("OruCa ã® Pod (pod.yml) ã‚’èµ·å‹•ã—ã¾ã™ã€‚")]
up: build
    @echo "--> ğŸš€ Starting OruCa"
    @docker compose --env-file ../../.env up -d

[doc("OruCa ã® Pod (pod.yml) ã‚’åœæ­¢ã—ã¾ã™ã€‚")]
down:
    @echo "--> ğŸ›‘ Stopping OruCa"
    @docker compose --env-file ../../.env down

[doc("OruCa ã® Podã¨Volume ã‚’åœæ­¢ã—ã¾ã™ã€‚")]
down-v:
    @echo "==> ğŸ—‘ï¸ Stopping pod and deleting volumes..."
    @docker compose --env-file ../../.env down --volumes

[doc("OruCa ã® MySQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã—ã¾ã™ã€‚")]
backup:
    @echo "ğŸ’¾ Saving OruCa MySQL backup..."
    @docker exec --env-file ../../.env oruca-mysql sh -c "mkdir -p /backups/$$(date +%Y%m%d-%H%M%S) && mysqldump -u$$MYSQL_USER -p$$MYSQL_PASSWORD $$MYSQL_DATABASE > /backups/$$(date +%Y%m%d-%H%M%S)/backup.sql"
    @echo "âœ… Backup created in OruCa mysql volume's /backups directory."

[doc("æŒ‡å®šã—ãŸæ—¥æ™‚ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰ MySQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚¹ãƒˆã‚¢ã—ã¾ã™ã€‚")]
restore BACKUP_DATE:
    @echo "ğŸ”„ Restoring OruCa MySQL backup from {{BACKUP_DATE}}..."
    @docker exec --env-file ../../.env -i oruca-mysql sh -c "mysql -u'root' -p$$MYSQL_ROOT_PASSWORD $$MYSQL_DATABASE < /backups/{{BACKUP_DATE}}/backup.sql"
    @echo "âœ… Restore complete."